{% load floppyforms %}
{% formconfig row using "floppyforms/rows/bootstrap.html" %}

<div class="panel panel-default">
	<header class="panel-heading">
		<h4 class="panel-title">Information</h4>
	</header>
	<div class="panel-body">
		{% formrow form.name %}
		{% formrow form.slug %}
		{% formrow form.website_url %}
		{% formrow form.description %}
		{% formrow form.banner_image %}
		{% formrow form.dance_styles %}
		{% formrow form.has_dances %}
		{% formrow form.has_classes %}
	</div>{# /.panel-body #}
</div>{# /.panel #}

<div class="panel panel-default">
	<header class="panel-heading">
		<h4 class="panel-title">Details</h4>
	</header>
	<div class="panel-body">
		<div class='row'>
			<div class='col-sm-4'>
				{% formrow form.start_date %}
			</div>
			<div class='col-sm-4'>
				{% formrow form.end_date %}
			</div>
			<div class='col-sm-4'>
				<label for='startEnd'>Add start / end times</label><br />
				<input type='checkbox' id='startEnd'{% if form.instance.start_time or form.instance.end_time %} checked{% endif %}>
			</div>
		</div>
		<div class='row' id='startEndRow'{% if not form.instance.start_time and not form.instance.end_time %} style="display:none;"{% endif %}>
			<div class='col-sm-4'>
				{% formrow form.start_time %}
			</div>
			<div class='col-sm-4'>
				{% formrow form.end_time %}
			</div>
		</div>

		<div class="row">
			<div class="col-sm-5">
				{% formrow form.city %}
			</div>
			<div class="col-sm-3">
				{% formrow form.state_or_province %}
			</div>
			<div class="col-sm-4">
				<div class='form-group'>
					<label class='control-label'>Country *</label>
					<select class="chosen-select" disabled>
						<option selected="selected">United States</option>
					</select>
				</div>
			</div>
		</div>{# /.row #}

		{% formrow form.timezone %}
		<div class='form-group'>
			<label class='control-label'>Currency *</label>
			<select class="chosen-select" disabled>
				<option selected="selected">USD</option>
			</select>
		</div>

		{% include "brambling/_stripe_note.html" %}
	</div>{# /.panel-body #}
</div>{# /.panel #}

<div class="panel panel-default">
	<header class="panel-heading">
		<h4 class="panel-title">Registration</h4>
	</header>
	<div class="panel-body">
		{% formrow form.cart_timeout %}
		<div class='form-group'>
			{% with field=form.collect_housing_data %}
				<div class='checkbox'>
					<label for="{{ field|id }}">{% formfield field %} {{ field.label }}</label>
				</div>
			{% endwith %}
			{% with field=form.collect_survey_data %}
				<div class='checkbox'>
					<label for="{{ field|id }}">{% formfield field %} {{ field.label }}</label>
					<small><a class="popped" data-container="body" data-toggle="popover" data-placement="top" data-title="Survey" data-html="true" data-content="
						{% filter force_escape %}
							<p>If checked, attendees will be presented with the following questions upon registration:</p>
							<ul>
								<li>How did you hear about this event?</li>
								<li>Would you like to distribute promotional materials?</li>
								<li>Can you provide housing for event attendees?</li>
							</ul>
						{% endfilter %}
					" tabindex="-1">What is the survey?</a></small>
				</div>
			{% endwith %}
		</div>
		{% formrow form.liability_waiver %}
	</div>{# /.panel-body #}
</div>{# /.panel #}

<div class="panel panel-default">
	<header class="panel-heading">
		<h4 class="panel-title">Sharing</h4>
	</header>
	<div class="panel-body">
		{% formrow form.privacy %}

		<p>The following people have access to edit this event. Only the event owner can add or remove editors.</p>

		<table class='table table-striped'>
			<thead>
				<tr>
					<th colspan="3">Permissions</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<th>{{ owner.get_full_name }}</th>
					<td>{{ owner.email }}</td>
					<td><i class='fa fa-fw fa-lock'></i> Owner</td>
					{% if owner == request.user %}<td></td>{% endif %}
				</tr>
				{% for editor in event.editors.all %}
					<tr>
						<th>{{ editor.get_full_name }}</th>
						<td>{{ editor.email }}</td>
						<td><i class='fa fa-fw fa-pencil'></i> Editor</td>
						{% if event.owner == request.user %}
							<td>
								<a href="{% url 'brambling_event_remove_editor' event_slug=event.slug pk=editor.pk %}"><i class='text-danger fa fa-fw fa-times'></i></a>
							</td>
						{% endif %}
					</tr>
				{% endfor %}
				{% for invite in event.get_invites %}
					<tr>
						<th>{{ invite.email }}</th>
						<td>{{ invite.email }}</td>
						<td>
							{% if invite.is_sent %}
								<i class='fa fa-fw fa-paper-plane'></i> Invitation sent
							{% else %}
								<i class='fa fa-fw fa-envelope'></i> Not sent
							{% endif %}
						</td>
						{% if event.owner == request.user %}
							<td>
								<a href='{% url "brambling_invite_delete" code=invite.code %}' class='tipped' data-toggle="tooltip" data-placement="top" data-container="body" title='Cancel invitation'><i class='text-danger fa fa-fw fa-times'></i></a>
								<a href='{% url "brambling_invite_send" code=invite.code %}' class='tipped' data-toggle="tooltip" data-placement="top" data-container="body" title='Send invitation'><i class='fa fa-fw fa-repeat fa-rotate-270 text-success'></i></a>
							</td>
						{% endif %}
					</tr>
				{% endfor %}
			</tbody>
		</table>

		{% formrow form.editors with label="Invite more editors" %}
	</div>{# /.panel-body #}
</div>{# /.panel #}

{% if form.instance.pk %}
	<div class='panel panel-default'>
		<header class="panel-heading">
			<h4 class="panel-title">Payment Options</h4>
		</header>
		<div class='panel-body'>
			<p>
				We currently offer two payment processors: Stripe and Dwolla.
				You may enable either or both processors.
			</p>
			<p>
				You must register for an account with each payment processor you
				use. Sales go directly to those accounts with Dancerfly&#8217;s
				fee automatically subtracted. Click the info icon next to each
				payment processor to learn more.
			</p>
			<table class="table table-striped">
				<thead>
					<tr>
						<th>Processor</th>
						<th>Status</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{# Stripe: #}
					{% if form.STRIPE_APPLICATION_ID %}
						<tr>
							<th>
								<i class="fa fa-fw fa-credit-card"></i>
								Stripe
								<a href="javascript:void(0);" class="popped" data-container=".panel-body" data-content="Stripe allows payment by credit card. They charge an additional 3.9% + 30¢ per transaction."><i class="fa fa-info-circle"></i></a>
							</th>
							{% if form.instance.uses_stripe %}
								<td>Enabled ({{ form.instance.stripe_user_id }})</td>
								<td>{% formrow form.disconnect_stripe with label="Disconnect" %}</td>
							{% else %}
								<td>Not Enabled</td>
								<td>
									<a href='https://connect.stripe.com/oauth/authorize?client_id={{ form.STRIPE_APPLICATION_ID }}&response_type=code&scope=read_write&state={{ form.instance.slug }}' class='btn btn-info btn-xs'>Connect</i></a>
								</td>
							{% endif %}
						</tr>
					{% endif %}

					{# Dwolla: #}
					{% if form.instance.connected_to_dwolla or dwolla_oauth_url %}
						<tr>
							<th>
								<i class="fa fa-fw fa-money"></i>
								Dwolla
								<a href="javascript:void(0);" class="popped" data-container=".panel-body" data-content="Dwolla allows payment from any user who has a Dwolla account. They charge an additional 25¢ per transaction or no fee for transactions under $10."><i class="fa fa-info-circle"></i></a>
							</th>
							{% if form.instance.connected_to_dwolla %}
								<td>Enabled ({{ form.instance.dwolla_user_id }})</td>
								<td>{% formrow form.disconnect_dwolla with label="Disconnect" %}</td>
							{% else %}
								<td>Not Enabled</td>
								<td>
									<a href='{{ dwolla_oauth_url }}' class='btn btn-xs btn-info'>Connect</a>
								</td>
							{% endif %}
						</tr>
					{% endif %}
				</tbody>
			</table>
		</div>
	</div>
{% endif %}
