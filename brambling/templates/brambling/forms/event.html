{% load floppyforms %}
{% formconfig row using "floppyforms/rows/bootstrap.html" %}

<div class="panel panel-default">
	<header class="panel-heading">
		<h4 class="panel-title">Information</h4>
	</header>
	<div class="panel-body">
		{% formrow form.name %}
		{% formrow form.slug %}
		{% formrow form.tagline %}
		{% formrow form.website_url %}
		{% formrow form.description %}
		<div class='row'>
			<div class='col-sm-6'>
				{% formrow form.logo_image %}
			</div>
			<div class='col-sm-6'>
				{% formrow form.banner_image %}
			</div>
		</div>
		{% formrow form.dance_styles %}
		{% formrow form.has_dances %}
		{% formrow form.has_classes %}
	</div>{# /.panel-body #}
</div>{# /.panel #}

<div class="panel panel-default">
	<header class="panel-heading">
		<h4 class="panel-title">Details</h4>
	</header>
	<div class="panel-body">
		<div class='row'>
			<div class='col-sm-4'>
				{% formrow form.start_date %}
			</div>
			<div class='col-sm-4'>
				{% formrow form.end_date %}
			</div>
			<div class='col-sm-4'>
				<label for='startEnd'>Add start / end times</label><br />
				<input type='checkbox' id='startEnd'{% if form.instance.start_time or form.instance.end_time %} checked{% endif %}>
			</div>
		</div>
		<div class='row' id='startEndRow'{% if not form.instance.start_time and not form.instance.end_time %} style="display:none;"{% endif %}>
			<div class='col-sm-4'>
				{% formrow form.start_time %}
			</div>
			<div class='col-sm-4'>
				{% formrow form.end_time %}
			</div>
		</div>

		<div class="row">
			<div class="col-sm-5">
				{% formrow form.city %}
			</div>
			<div class="col-sm-3">
				{% formrow form.state_or_province %}
			</div>
			<div class="col-sm-4">
				{% formrow form.country %}
			</div>
		</div>{# /.row #}

		{% formrow form.timezone %}

		<small><a href="https://support.stripe.com/questions/which-currencies-does-stripe-support" class="pull-right">Supported Currencies</a></small>
		{% formrow form.currency %}

		{% include "brambling/_stripe_note.html" %}
	</div>{# /.panel-body #}
</div>{# /.panel #}

<div class="panel panel-default">
	<header class="panel-heading">
		<h4 class="panel-title">Settings</h4>
	</header>
	<div class="panel-body">
		{% formrow form.cart_timeout %}
		<div class='form-group'>
			{% with field=form.collect_housing_data %}
				<div class='checkbox'>
					<label for="{{ field|id }}">{% formfield field %} {{ field.label }}</label>
				</div>
			{% endwith %}
			{% with field=form.collect_survey_data %}
				<div class='checkbox'>
					<label for="{{ field|id }}">{% formfield field %} {{ field.label }}</label>
					<small><a class="popped" data-container="body" data-toggle="popover" data-placement="top" data-title="Survey" data-html="true" data-content="
						{% filter force_escape %}
							<p>If checked, attendees will be presented with the following questions upon registration:</p>
							<ul>
								<li>How did you hear about this event?</li>
								<li>Would you like to distribute promotional materials?</li>
								<li>Can you provide housing for event attendees?</li>
							</ul>
						{% endfilter %}
					" tabindex="-1">What is the survey?</a></small>
				</div>
			{% endwith %}
		</div>
		{% formrow form.liability_waiver %}
		{% formrow form.privacy %}
		{% formrow form.editors %}
	</div>{# /.panel-body #}
</div>{# /.panel #}

{% if form.instance.pk %}
	<div class='panel panel-default'>
		<header class="panel-heading">
			<h4 class="panel-title">Payment Options</h4>
		</header>
		<div class='panel-body'>
			{% if form.STRIPE_APPLICATION_ID %}
				<h3>Stripe</h3>

				{% if form.instance.uses_stripe %}
					<p>Connected account: {{ form.instance.stripe_user_id }}</p>
					{% formrow form.disconnect_stripe with label="Disconnect" %}
				{% else %}
					<a href='https://connect.stripe.com/oauth/authorize?client_id={{ form.STRIPE_APPLICATION_ID }}&response_type=code&scope=read_write&state={{ form.instance.slug }}' class='btn btn-primary'>Connect to Stripe <i class='fa fa-external-link'></i></a>
				{% endif %}

				<hr />
			{% endif %}

			{% if form.instance.uses_dwolla or dwolla_oauth_url %}
				<h3>Dwolla</h3>

				{% if form.instance.uses_dwolla %}
					<p>Connected account: {{ form.instance.dwolla_user_id }}</p>
					{% formrow form.disconnect_dwolla with label="Disconnect" %}
				{% else %}
					<a href='{{ dwolla_oauth_url }}' class='btn btn-primary'>Connect to Dwolla <i class='fa fa-external-link'></i></a>
				{% endif %}
			{% endif %}
		</div>
	</div>
{% endif %}
