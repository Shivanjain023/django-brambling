{% extends 'brambling/event/__base.html' %}

{% load floppyforms %}

{% block main %}
	<h2>Reserve things!</h2>

	<div class="row">
		<div class="col-md-8">
			{% for item, forms in items %}
				<div class='panel panel-default'>
					<header class='panel-heading'>
						<div class='panel-title'>{{ item.name }}</div>
					</header>
					<div class='panel-body'>
						<ul class='list-inline'>
							{% for form in forms %}
								<li>
									<form action="{{ request.path }}" method="post">
										{% csrf_token %}
										<button type="submit" class="btn btn-lg btn-primary">{{ form.item_option.name }}</button>
										{% for field in form %}{{ field.as_hidden }}{% endfor %}
									</form>
								</li>
							{% endfor %}
						</ul>
					</div>
				</div>
			{% endfor %}
		</div>
		<div class="col-md-4">
			<form action="" method='post'{% if discount_form.errors %} class="has-error"{% endif %}>
				{% csrf_token %}
				<div class='input-group'>
					{% form discount_form using %}
						{% formfield discount_form.discount with placeholder="Discount code" autocomplete="off" %}
					{% endform %}
					<span class='input-group-btn'>
						<button class='btn btn-default' type='submit'><span class='glyphicon glyphicon-plus'></span></button>
					</span>
				</div>
				{% include "floppyforms/errors.html" with errors=discount_form.discount.errors %}

			</form>
			{% if cart %}
				<div class='panel panel-default'>
					<header class='panel-heading'>
						<div class='panel-title'>Cart ({{ cart_total }})</div>
					</header>
					{% regroup cart by item as cart_list %}
					<ul class='list-group'>
						{% for options in cart_list %}
							<li class='list-group-item'><strong>{{ options.grouper }}</strong></li>
							{% for option in options.list %}
								<li class='list-group-item'>
									<span class="badge">{{ option.quantity }}</span>
									{{ option.name }}
								</li>
							{% endfor %}
						{% endfor %}
					</ul>
					<div class='list-group'>
						<a class='list-group-item' href="{% url 'brambling_event_cart' slug=event.slug %}">
							<span class='glyphicon glyphicon-shopping-cart'></span>
							Continue checkout
						</a>
					</div>
				</div>
			{% endif %}
		</div>
	</div>
{% endblock %}
