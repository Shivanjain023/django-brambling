{# This whole template is verbatim - use ractive, not Django. #}
{% verbatim %}

<div class="masthead clearfix masthead-light">
  <div class="masthead-cover-image"{{#if event.banner_image }} style="background-image: url({{ event.banner_image }})"{{/if}}>
    <div class="relative">
      <div id="mastheadDetails" class="relative-bottom relative-left relative-right">
        {{#if event.description }}
          <h1 class="text-accent masthead-h1-alone{{#if editable_by_user }} masthead-h1-admin{{/if}}">
            <a class="a-uncolored" href="">{{ event.name }}</a>
          </h1>
        {{else}}
          <h1 class="text-accent{{#if editable_by_user }} masthead-h1-admin{{/if}}">
            <a class="a-uncolored" href="">{{ event.name }}</a>
          </h1>
          <p class="text-large margin-trailer-0">
            <i class="fa fa-clock-o fa-fw"></i>
            {{ event.start_date }} at {{ event.start_time }}
            <i class="fa fa-map-marker fa-fw"></i>
            {{ event.city }}, {{ event.state_or_province }}, {{ event.country }}
          </p>
        {{/if}}
      </div>{{!-- /.relative-bottom.relative-left.relative-right --}}

      {{#if editable_by_user }}
        <a href="summary" class="btn btn-primary-light relative-top relative-right">
          <i class="fa fa-cog"></i> Manage Event
        </a>
      {{/if}}
    </div>{{!-- /.relative --}}
  </div>{{!-- /.masthead-cover-image --}}
</div>{{!-- /.masthead --}}

{{#if event.description || event.website_url || event.facebook_url || event.dance_styles }}
  <div class="hug panel panel-dark">
    <div class="panel-body">
      {{#if event.description }}
        <div class="row">
          <div class="col-md-4">
            <div class="media text-large">
              <div class="media-left">
                <i class="fa fa-clock-o fa-fw"></i>
              </div>
              <div class="media-body">
                {{ event.start_date }} at {{ event.start_time }}
              </div>
            </div>
            <div class="media text-large">
              <div class="media-left">
                <i class="fa fa-map-marker fa-fw"></i>
              </div>
              <div class="media-body">
                {{ event.city }}, {{ event.state_or_province }}, {{ event.country }}
              </div>
            </div>
            {{#if event.dance_styles }}
              <div class="media text-large">
                <div class="media-left">
                  <i class="fa fa-fw"></i>
                </div>
                <div class="media-body">
                  {{#each event.dance_styles}}
                    <h4 class="text-muted">{{ . }}</h4>
                  {{/each}}
                </div>
              </div>
            {{/if}}
          </div>
          <div class="col-md-8">
            <div>
              {{ linebreaks(event.description) }}
            </div>
            {{#if event.website_url }}
              <a target="_blank" href="{{ event.website_url }}" class="btn btn-primary">
                <i class="fa fa-fw fa-globe"></i>
                Website
              </a>
            {{/if}}
            {{#if event.facebook_url }}
              <a target="_blank" href="{{ event.facebook_url }}" class="btn btn-primary">
                <i class="fa fa-fw fa-facebook"></i>
                Facebook
              </a>
            {{/if}}
          </div>
        </div>
      {{else}}
        {{#if event.website_url }}
          <a target="_blank" href="{{ event.website_url }}" class="btn btn-primary">
            <i class="fa fa-fw fa-globe"></i>
            Website
          </a>
        {{/if}}
        {{#if event.facebook_url }}
          <a target="_blank" href="{{ event.facebook_url }}" class="btn btn-primary">
            <i class="fa fa-fw fa-facebook"></i>
            Facebook
          </a>
        {{/if}}
        {{#if event.dance_styles }}
          <h4 class="text-muted event-tags">Featuring {{#each event.dance_styles }}<span class="list-comma text-lowercase">{{ . }}</span>{{/each}}.</h4>
        {{/if}}
      {{/if}}
    </div>
  </div>
{{/if}}


{{#if items }}

  <h1 class="margin-leader-dbl">Register for {{ event.name }}</h1>

  <div class="row" id="items-list">
    <div class="col-md-5 col-md-push-7">

      {{#if has_cart(order) }}
        <div class="margin-trailer">
          {{!% include "brambling/event/order/_expiry_countdown.html" with expiry_time=order.cart_expire_time }}
        </div>
        <div class='panel panel-default'>
          <header class='panel-heading'>
            <div class='panel-title'>
              <i class="fa fa-fw fa-shopping-cart"></i> Cart
            </div>
          </header>
          <ul class='list-group'>
            {{#each order.bought_items}}
              {{#if status == 'reserved'}}
                <li class='list-group-item'>
                  {{#with fetch(item_option)}}
                    {{#with fetch(item)}}
                      {{ nameÂ }}
                    {{/with}}
                    ({{ name }})
                    {{!-- This SHOULD run a delete BoughtItem action. --}}
                    <a on-click='alert("hi!")' href='javascript://' class='text-danger pull-right'><span class='fa fa-times'></span></a>
                  {{/with}}
                </li>
              {{/if}}
            {{/each}}
          </ul>
        </div>
      {{/if}}
    </div>
    <div class="col-md-7 col-md-pull-5 margin-leader margin-leader-md-0">
      {{#each items }}
        <div class='panel panel-default'>
          <header class='panel-heading clearfix'>
            {{#if images }}
              <img src="{{ images.0.image }}" class="img-responsive pull-right item-img" data-toggle="modal" data-target="#imageModal{{ @index }}">
            {{/if}}
            <div class='panel-title'>{{ name }}</div>
            {{#if description }}
              <div class="shortened" data-lines="2">
                {{ linebreaks(description) }}
              </div>
            {{/if}}
            {{#if images }}
              {{#if images.length > 1 }}<a href="" data-toggle="modal" data-target="#imageModal{{ @index }}">{{ images.length }} photo{{ pluralize(images.length) }}</a>{{/if}}
              <div class="modal fade" id="imageModal{{ @index }}" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                      <h4 id="myLargeModalLabel">{{ name }}</h4>
                    </div>
                    <div id="item-carousel{{ @index }}" class="carousel slide" data-ride="carousel" data-interval="false">
                    {{#if images.length > 1 }}
                      <!-- Indicators -->
                      <ol class="carousel-indicators">
                        {{#images}}
                          <li data-target="#item-carousel{{ @index }}" data-slide-to="{{ @index - 1 }}"{{#if @index === 0 }} class="active"{{/if}}></li>
                        {{/images}}
                      </ol>
                    {{/if}}
                    <!-- Wrapper for slides -->
                    <div class="carousel-inner text-center">
                      {{#images}}
                        <div class="item{{#if @index === 0 }} active{{/if}}">
                          <img src="{{ image }}">
                        </div>
                      {{/images}}
                    </div>
                    {{#if images.length > 1 }}
                      <!-- Controls -->
                      <a class="left carousel-control" href="#item-carousel{{ @index }}" role="button" data-slide="prev">
                        <i class="fa fa-2x fa-chevron-left"></i>
                      </a>
                      <a class="right carousel-control" href="#item-carousel{{ @index }}" role="button" data-slide="next">
                        <i class="fa fa-2x fa-chevron-right"></i>
                      </a>
                    {{/if}}
                  </div>
                  </div>
                </div>
              </div>
            {{/if}}
          </header>
          <div class='list-group relative'>
            {{#options}}
              {{! This SHOULD add items to the cart}}
              <a href='javascript://' class="list-group-item {{#if option.total_number && option.remaining <= 0 }} disabled{{/if}}">
                <div class='row'>
                  <div class='col-xs-12 col-sm-6'>
                    {{ option.name }}
                    <span class='fa fa-plus pull-right visible-xs'></span>
                  </div>
                  <div class='col-xs-8 col-sm-3 text-left text-right-sm'>
                    {{#if option.total_number && option.remaining_display != 'hidden' }}
                      {{#if option.remaining_display == 'both' }}
                        {{ option.remaining }} / {{ option.total_number }} left
                      {{elseif option.remaining_display == 'total' }}
                        {{ option.total_number }} total
                      {{else}}
                        {{ option.remaining }} left
                      {{/if}}
                    {{else}}
                      &nbsp;
                    {{/if}}
                  </div>
                  <div class='col-xs-4 col-sm-2 text-right'>{{ format_money(option.price, event.currency) }}</div>
                  <div class='col-sm-1 text-right hidden-xs'>{{#if !option.total_number || option.remaining > 0 }}<span class='fa fa-plus'></span>{{/if}}</div>
                </div>
              </a>
            {{/options}}
          </div>
        </div>
      {{/each}}
    </div>
  </div>
{{else}}
  <div class="row">
    <div class="col-sm-8">
      <h4>{{ event.name }} doesn't have any passes or merchandise available right now. Check back later or contact an event organizer.</h4>
    </div>
  </div>
{{/if}}

{% endverbatim %}
