{% extends 'brambling/event/organizer/__base.html' %}

{% load floppyforms zenaida staticfiles %}

{% block title %}Order {{ order.code }} â€“ {{ block.super }}{% endblock %}

{% block javascripts %}
	{{ block.super }}

	<script type="text/javascript" src="{% static 'zenaida/js/bootstrap/tab.js' %}"></script>
	<script type="text/javascript" src="{% static 'zenaida/js/bootstrap/modal.js' %}"></script>
	<script>
		$(function() {
			$('[data-toggle=tab]').click(function (e) {
				e.preventDefault();
				$(this).tab('show');
			});
			$('.removeDiscountLink').on('click', function(e){
				e.preventDefault();
				$.post($(this).attr('href'), function(){
					location.reload();
				});
			});
			$('.payment-confirmation-toggle').on('click', function(e) {
				e.preventDefault();
				var $this = $(this);
				$.getJSON(this.href, function(data) {
					if (data.is_confirmed) {
						$this.html("<i class='fa fa-check text-success'></i>");
					} else {
						$this.html("<i class='fa fa-ban text-danger'></i>");
					}
				});
			});
		});
	</script>

{% endblock %}

{% block main %}
	{{ block.super }}

	<h2>Order {{ order.code }} ({{ order.get_status_display }})</h2>
	<h3>{% if order.person %}<a href="mailto:{{ order.person.email }}">{{ order.person.get_full_name }} &lt;{{ order.person.email }}&gt;</a>{% else %}<a href="mailto:{{ order.email }}">{{ order.email }}</a>{% endif %}</h3>

	<!-- Nav tabs -->
	<ul class="nav nav-tabs" role="tablist">
	  <li{% if not payment_form.is_bound and not discount_form.is_bound %} class="active"{% endif %}><a href="#summary" role="tab" data-toggle="tab">Order summary</a></li>
	  <li{% if payment_form.is_bound %} class="active"{% endif %}><a href="#payment" role="tab" data-toggle="tab">Record payment</a></li>
	  <li{% if discount_form.is_bound %} class="active"{% endif %}><a href="#discount" role="tab" data-toggle="tab">Apply discount</a></li>
	</ul>

	<!-- Tab panes -->
	<div class="tab-content">
		<div class="tab-pane{% if not payment_form.is_bound and not discount_form.is_bound %} active{% endif %}" id="summary">
			{% include "brambling/event/organizer/_admin_order_summary.html" %}
		</div>
		<div class="tab-pane{% if payment_form.is_bound %} active{% endif %}" id="payment">
			<div class='row'>
				<div class='col-sm-6 col-sm-offset-3'>
					<form method='post' action=''>
						{% csrf_token %}
						<input type='hidden' name='is_payment_form' value='1'>
						{% form payment_form using %}
							{% formrow payment_form.method with using="floppyforms/radio.html" inline=1 %}
							{% formrow payment_form.amount with append=event.currency %}
						{% endform %}
						<button type='submit' class='btn btn-primary'>Record payment</button>
					</form>
				</div>
			</div>
		</div>
		<div class="tab-pane{% if discount_form.is_bound %} active{% endif %}" id="discount">
			<div class='row'>
				<div class='col-sm-6 col-sm-offset-3'>
					<form method='post' action=''>
						<input type='hidden' name='is_discount_form' value='1'>
						{% csrf_token %}
						{% form discount_form %}
						<button type='submit' class='btn btn-primary'>Apply discount</button>
					</form>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

